function filterCount(){if($("#ads-filter").length){var e=filterParams("#ads-filter");e&&e!=$("#ads-filter").attr("data-params")&&($("#ads-filter").attr("data-params",e),$.ajaxSetup({async:!1}),$.post("/filter/ads-count",{params:e},function(e){0===e?($("#ads-filter .blue-btn").hide(),$(".btn-wrapper .empty").length||$(".btn-wrapper").append('<span class="empty">Ничего не найдено</span>'),$("#select-list").empty()):($(".btn-wrapper .empty").length&&$(".btn-wrapper .empty").remove(),$("#ads-filter .blue-btn").is(":hidden")&&$("#ads-filter .blue-btn").show(),$("#ads-filter .blue-btn").html(e))}))}}function filterParams(e){e=$(e).serializeArray().filter(function(e){return!!e.value});return $.param(e)}function filterScroll(){$("#filters").length&&($("#filters").offset().top+$("#filters").height()<$(window).scrollTop()?($(".all-filters-anchor").addClass("active"),$(".filters .m-all-filters").addClass("active"),$(".footer").addClass("bottom")):($(".all-filters-anchor").removeClass("active"),$(".filters .m-all-filters").removeClass("active"),$(".footer").removeClass("bottom")))}$(".navbar-header .navbar-toggle").on("click",function(){$(this).toggleClass("active"),$(this).parent().toggleClass("active"),$(".header-menu-wrapper").toggleClass("open")}),$(".header-menu-wrapper .header-bg").on("click",function(){$(".navbar-header .navbar-toggle").toggleClass("active"),$(".navbar-header .navbar-toggle").parent().toggleClass("active"),$(".header-menu-wrapper").toggleClass("open")}),$("body").on("click",".car-marks .car-mark.show-all",function(){var e=$(".car-marks").offset().top-20;event.preventDefault(),$(this).find(".title").text($(".car-marks.all").is(":visible")?"Все марки":"Популярные марки"),$(".car-marks.all").toggle(),$("body,html").animate({scrollTop:e},500)}),$("body").on("click",".car-models .car-model.show-all",function(){var e=$(".car-models").offset().top-20;event.preventDefault(),$(this).find(".title").text($(".car-models.all").is(":visible")?"Все модели":"Показать меньше"),$(".car-models.all").toggle(),$("body,html").animate({scrollTop:e},500)}),$("body").on("click",".car-marks .car-mark a, .car-logos a",function(){event.preventDefault(),$("#auto_model").is(":disabled")&&$("#brand").val($(this).attr("href")).trigger("change.select2").trigger("select2:select"),$(".all-filters-anchor").trigger("click")}),$("body").on("click",".car-models .car-model a",function(){event.preventDefault(),$("#auto_model").val($(this).attr("href")).trigger("change.select2").trigger("select2:select"),$("#select-list").empty(),$(".all-filters-anchor").trigger("click")}),$("#ads-filter select, #ads-filter input, #locations").on("change",function(){filterCount()}),$("#auto_model").on("depdrop:afterChange",function(e,t,a){"/cars/all"==$("#ads-filter").attr("action")&&(-1!==$("#ads-filter").attr("data-params").indexOf("brand")&&-1!==$("#ads-filter").attr("data-params").indexOf("auto_model")&&$("#select-list").empty(),a&&-1==$("#ads-filter").attr("data-params").indexOf("auto_model")&&!$(".btn-wrapper .empty").length&&($("#select-list").hide(),$.post("/filter/select-list",{id:a},function(e){e&&($(".car-logos").remove(),$("#select-list").html(e),$("#select-list").show(),filterCount())})))}),$("#ads-filter").on("beforeSubmit",function(){var e=filterParams("#ads-filter");return-1!==e.indexOf("brand")?$.post("/filter/slug",{params:e},function(e){window.location=e}):window.location=this.action+(e?"?"+e:""),!1}),$("#catalog-filter").on("beforeSubmit",function(){var e=filterParams("#catalog-filter");return-1!==e.indexOf("type")&&$.post("/filter/catalog-slug",{params:e},function(e){window.location=e}),!1}),$("#user-login").on("beforeSubmit",function(){if(0===$(this).find(".has-error").length&&($(".sms-block").hasClass("hide")||$(".repeat-send-code").hasClass("hide")))return $.post($(this).attr("action"),{phone:$("#loginform-phone").val()},function(e){e&&($(".sms-block").removeClass("hide"),$("#user-login .send").attr("disabled",!0))}),!1}),$("#loginform-sms").on("keyup",function(){4==$(this).val().length&&$("#user-login").submit()}),$(".repeat-send-code").on("click",function(){var e=60;return $("#user-login").submit(),$(this).addClass("hide"),$(".field-loginform-sms").append('<div id="new_sms">Повторно можно будет отправить через: <span>'+e+"</span> c</div>"),setTimeout(function t(){e--;e>0?(setTimeout(t,1e3),$("#new_sms span").text(e)):($("#new_sms").remove(),$(".repeat-send-code").removeClass("hide"))},1e3),!1}),$(".engine-type ul li a").on("click",function(){return $(".engine-type ul li").removeClass("active"),$.post(window.location.href,{id:$(this).attr("href")},function(e){$("#specification").html(e)}),$(this).closest("li.list-item").addClass("active"),!1}),$(".sort-list a").click(function(){return $("input[name=sort]").val($(this).attr("href")),$("#ads-filter").submit(),!1}),$("#create-ad .continue").click(function(){$("#create-ad .step.hidden, #create-ad .continue-wrapper.hidden").removeClass("hidden"),$("#create-ad .continue-wrapper.more").addClass("hidden")}),$("#image").on("filesorted",function(e,t){var a=[];$.each(t.stack,function(e,t){a.push(t.key)}),$.post("/client/sort-image?ad_id="+$("#create-ad").data("ad_id"),{images:a.join(",")},function(e){e&&$(".file-preview-status.text-success").html('<p class="msg-success"><button type="button" class="close"><span aria-hidden="true" onclick="$(\'.msg-success\').remove()">×</span></button>Изменение позиции сохранено.</p>')})}),filterScroll(),$(window).scroll(function(){filterScroll()}),$(".all-filters-anchor").on("click",function(e){e.preventDefault();var t=$(this).data("href"),a=$(t).offset().top;$("body,html").animate({scrollTop:a},500)}),$(".filters .filters-wrapper .m-all-filters").click(function(){$(".filters .filters-group.more").removeClass("hidden-xs"),$(".mobile-all-filters, #filters").addClass("open"),$(".top-navigation .row").css("margin","10px -10px 10px 0"),$(".top-navigation .navigation-left, .top-navigation .navigation-right, .car-marks, .news, footer, .reset-filters, .filters-wrapper .blue-btn, .mob-sort, .list-item, #select-list").toggleClass("hidden-xs")}),$(".mobile-all-filters .filter-cancel").click(function(){$(".filters .filters-group.more").addClass("hidden-xs"),$(".mobile-all-filters, #filters").removeClass("open"),$(".top-navigation .row").removeAttr("style"),$(".top-navigation .navigation-left, .top-navigation .navigation-right, .car-marks, .news, footer, .reset-filters, .filters-wrapper .blue-btn, .mob-sort, .list-item, #select-list").toggleClass("hidden-xs")}),$(".mobile-all-filters a.filter-reset, .filters .reset-filters a").click(function(){if("#"==$(this).attr("href"))return $("#ads-filter select").val(null).trigger("change.select2"),$("#ads-filter")[0].reset(),$("#auto_model, #generation").prop("disabled",!0),$.get("/site/index",function(e){$("#ads-filter .blue-btn").remove(),$("#ads-filter .btn-wrapper").html($(e).find("#ads-filter .blue-btn")),$("#select-list").html($(e).find("#select-list")),$(".filters-wrapper .blue-btn").toggleClass("hidden-xs")}),!1});